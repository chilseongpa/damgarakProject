<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>건의함 확인</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="/static/js/post/board/board2.js"></script>
  <link rel="stylesheet" href="/static/css/post/boardcss/post3.css">
  <link rel="stylesheet" href="/static/css/common/header.css">
  <link rel="stylesheet" href="/static/css/common/footer.css">
</head>
<body>
	<div th:replace="common/header::header" style="position: relative; z-index: 2;"></div>

  <h2 style="text-align: center;margin-top: 250px;">건의함 확인</h2>
  <br>
  
  <button class="btn" id="bttn">&#9776;</button>
  <div id="menu-container">
    <th:block th:insert="~{post/board/manager/menu2 :: nav}"></th:block>
  </div>
  <div>
  
	  <div class="title-1">
		    <div class="title">
		      <div style="text-align: right;">
		        <h5 th:text="'조회 ' + ${post.postCount}">조회수</h5>
		        <h5 th:text="${#dates.format(post.creationDate, 'yyyy-MM-dd HH:mm')}">작성 날짜</h5>
		      </div>
		      <table id="TBA">
		        <thead>
		          <tr>
		            <th class="test2">제목</th>
		            <th class="test2" th:text="${post.title}">제목</th>
		            <th class="test2">작성자</th>
		            <th class="test2" th:text="${post.usersName}">작성자 이름</th>
		          </tr>
		        </thead>
		        <tbody>
		          <tr>
		            <th class="test2">내용</th>
		            <th id="lucky" th:text="${post.content}">내용</th>
		          </tr>
		        </tbody>
		      </table>
		      <br><br>
		      <a href="javascript:history.back()" class="btn btn-secondary">뒤로가기</a>
		      <hr style="border: none; height: 2px; background-color: blue;">
		      <br><br>
		      
		      <div>
		        <table id="replyInputArea" class="table" align="center">
		          <thead>
		              <tr>
		                  <th colspan="2">
		                      <textarea id="content" cols="55" rows="2" class="form-control" style="resize: none;" placeholder="댓글을 입력하세요"></textarea>
		                  </th>
		                  <th style="vertical-align:middle;">
		                      <button id="addReply" class="btn btn-danger" onclick="addReply()">등록</button>
		                  </th>
		              </tr>             
		          </thead>
		        </table>
		      </div>
		  </div>   
	  </div> 

      <!-- 댓글 목록 영역 -->
	  <div id="replyList">
	    <div th:each="reply : ${replist}" style="display: flex; justify-content: space-between;">
	        <span th:text="${reply.usersName}" style="text-align: left; flex: 1;">작성자 이름</span>
	        <span th:text="${reply.replyComment}" style="text-align: center; flex: 1;">댓글 내용</span>
	        <span th:text="${#dates.format(reply.creationDate, 'yyyy-MM-dd HH:mm')}" style="text-align: right; flex: 1;">작성 날짜</span>
	    </div>
	  </div>
	  <div th:replace="common/footer :: footer"></div>
  	
</div>
	  <script>
	    // Ajax를 통해 댓글을 전송하고 저장 후 화면에 표시
	    function addReply() {
	        const replyContent = $("#content").val().trim();
	        
	        if (replyContent.length > 0) {
	            $.ajax({
	                url: '/manager/insertReply',  // 서버로 댓글 데이터를 전송할 엔드포인트
	                type: 'POST',
	                contentType: 'application/json',
	                data: JSON.stringify({
	                    postNo: getPostNo(),
	                    replyComment: replyContent
	                }),
	                success: function(response) {
	                    if (response.status === 'success') {
	                        $("#content").val(''); // 입력창 초기화
	                        addNewReplyToDOM(response.replyData); // 새 댓글을 DOM에 추가
	                        alert('댓글 추가에 실패했습니다.');
	                    } else {
	                        alert('댓글 추가에 성공했습니다.');
	                    }
	                },
	                error: function(err) {
	                    console.log('댓글 추가 요청 실패');
	                    console.log(err);
	                }
	            });
	        } else {
	            alert("내용을 입력 후 추가 가능합니다.");
	        }
	    }
	
	    // 새 댓글을 화면에 추가하는 함수
	    function addNewReplyToDOM(replyData) {
	        const newReplyDiv = document.createElement("div");
	        newReplyDiv.setAttribute("style", "display: flex; justify-content: space-between;");
	
	        const userNameSpan = document.createElement("span");
	        userNameSpan.setAttribute("style", "text-align: left; flex: 1;");
	        userNameSpan.textContent = replyData.usersName;
	
	        const commentSpan = document.createElement("span");
	        commentSpan.setAttribute("style", "text-align: center; flex: 1;");
	        commentSpan.textContent = replyData.replyComment;
	
	        const dateSpan = document.createElement("span");
	        dateSpan.setAttribute("style", "text-align: right; flex: 1;");
	        dateSpan.textContent = new Date(replyData.creationDate).toLocaleString();
	
	        newReplyDiv.appendChild(userNameSpan);
	        newReplyDiv.appendChild(commentSpan);
	        newReplyDiv.appendChild(dateSpan);
	
	        document.getElementById("replyList").appendChild(newReplyDiv);
	    }
	
	    // URL에서 postNo 추출하는 함수
	    function getPostNo() {
	        const urlParams = new URLSearchParams(window.location.search);
	        return urlParams.get('postNo');
	    }
	  </script>
  
</body>
</html>
